<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Worksheet 1, Part 2</title>
    <link rel="stylesheet" href="../../css/main.css">
</head>

<body>
  <div class="container">
    <a href="../" class="back-link">← Back to Worksheet 1</a>
    <h1>Worksheet 1 · Part 2</h1>
    <canvas id="gfx" width="640" height="320"></canvas>
  </div>


    <script defer src="../../common/MV.js"></script>

    <script id="shader-rays" type="x-shader/wgsl">
    struct VSOut {
      @builtin(position) pos : vec4<f32>,
      @location(0) img : vec2<f32>,   // image-plane coords ∈ [-1,1]^2
    };

    @vertex
    fn vsMain(@builtin(vertex_index) vid : u32) -> VSOut {
      var corners = array<vec2<f32>, 4>(
        vec2<f32>(-1.0, -1.0),
        vec2<f32>( 1.0, -1.0),
        vec2<f32>(-1.0,  1.0),
        vec2<f32>( 1.0,  1.0)
      );
      var out : VSOut;
      let p = corners[vid];
      out.pos = vec4<f32>(p, 0.0, 1.0);
      out.img = p;
      return out;
    }

    struct Camera {
    aspect : f32,
    zoom   : f32,
    _pad   : vec2<f32>,
    eye    : vec4<f32>,
    U      : vec4<f32>,
    V      : vec4<f32>,
    W      : vec4<f32>,
    };
    @group(0) @binding(0) var<uniform> cam : Camera;
    
    struct Ray { origin: vec3<f32>, dir: vec3<f32> };
    
    @fragment
    fn fsMain(@location(0) img : vec2<f32>) -> @location(0) vec4<f32> {
    let center = cam.eye.xyz + cam.zoom * cam.W.xyz;
    
    let P = center + (img.x * cam.aspect) * cam.U.xyz
                    +  img.y               * cam.V.xyz;
    
    let dir = normalize(P - cam.eye.xyz);
    let ray = Ray(cam.eye.xyz, dir);
    
    let rgb = ray.dir * 0.5 + vec3<f32>(0.5, 0.5, 0.5);
    return vec4<f32>(rgb, 1.0);
    }

  </script>

    <script type="module" src="main.js"></script>
</body>

</html>